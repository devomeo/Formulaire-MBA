generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  USER
}

enum SubmissionStatus {
  DRAFT
  SUBMITTED
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String   @map("password_hash")
  role         UserRole @default(USER)
  displayName  String   @map("display_name")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  forms       Form[]
  submissions Submission[]
}

model Form {
  id          String      @id @default(cuid())
  name        String
  slug        String      @unique
  description String?
  isPublished Boolean     @default(false) @map("is_published")
  createdBy   String      @map("created_by")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  creator     User        @relation(fields: [createdBy], references: [id])
  fields      FormField[]
  submissions Submission[]
}

model FormField {
  id           String   @id @default(cuid())
  formId       String   @map("form_id")
  keyName      String   @map("key_name")
  label        String
  type         String
  sortOrder    Int      @default(0) @map("sort_order")
  isRequired   Boolean  @default(false) @map("is_required")
  placeholder  String?
  helpText     String?  @map("help_text")
  configJson   Json?    @map("config_json")
  conditional  Json?    @map("conditional_json")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  form        Form      @relation(fields: [formId], references: [id])
  values      SubmissionValue[]
  files       SubmissionFile[]

  @@unique([formId, keyName])
}

model Submission {
  id        String           @id @default(cuid())
  formId    String           @map("form_id")
  userId    String           @map("user_id")
  status    SubmissionStatus @default(SUBMITTED)
  createdAt DateTime         @default(now()) @map("created_at")
  updatedAt DateTime         @updatedAt @map("updated_at")

  form      Form             @relation(fields: [formId], references: [id])
  user      User             @relation(fields: [userId], references: [id])
  values    SubmissionValue[]
  files     SubmissionFile[]
}

model SubmissionValue {
  id           String   @id @default(cuid())
  submissionId String   @map("submission_id")
  fieldId      String   @map("field_id")
  valueJson    Json     @map("value_json")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  submission  Submission @relation(fields: [submissionId], references: [id])
  field       FormField  @relation(fields: [fieldId], references: [id])

  @@unique([submissionId, fieldId])
}

model SubmissionFile {
  id           String   @id @default(cuid())
  submissionId String   @map("submission_id")
  fieldId      String   @map("field_id")
  originalName String   @map("original_name")
  storedName   String   @map("stored_name")
  mimeType     String   @map("mime_type")
  sizeBytes    Int      @map("size_bytes")
  storagePath  String   @map("storage_path")
  createdAt    DateTime @default(now()) @map("created_at")

  submission  Submission @relation(fields: [submissionId], references: [id])
  field       FormField  @relation(fields: [fieldId], references: [id])
}
